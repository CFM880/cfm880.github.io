<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Androidæ¶ˆæ¯æœºåˆ¶ | JsonMi</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Androidæ¶ˆæ¯æœºåˆ¶</h1><a id="logo" href="/.">JsonMi</a><p class="description">Android Java</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> ä¸»é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äºæˆ‘</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Androidæ¶ˆæ¯æœºåˆ¶</h1><div class="post-meta">Nov 10, 2017</div><div class="post-content"><p>æœ€è¿‘æœç‹é¢è¯•çš„æ—¶å€™ï¼Œè¢«é—®åˆ°å­çº¿ç¨‹ä¸­æ˜¯å¦å¯ä»¥åˆ›å»ºHandlerå½“æ—¶æ¯”è¾ƒè’™ï¼Œæ²¡é—®ç­”å¥½ï¼Œè¿˜æœ‰ï¼ŒViewä¸­çš„postå’ŒHandlerä¸­çš„postæœ‰å•¥åŒºåˆ«ï¼Œsoç°åœ¨æ¥è¯´è¯´Androidæ¶ˆæ¯æœºåˆ¶</p>
<p>Note:ä¸‹é¢è®¨è®ºçš„åªæ˜¯åœ¨UIçº¿ç¨‹ä¸­ï¼Œæˆ–è€…ä¼ å…¥çš„æ˜¯ä¸»çº¿ç¨‹çš„Looperï¼ŒUIçº¿ç¨‹ä¹Ÿç»Ÿä¸€ç§°ä¸ºä¸»çº¿ç¨‹</p>
<h1 id="ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆæ¯æœºåˆ¶"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆæ¯æœºåˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆæ¯æœºåˆ¶"></a>ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆæ¯æœºåˆ¶</h1><p>åœ¨Androidä¸­æ˜¯ä¸å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UIçš„ï¼Œsoéœ€è¦ä¸€ä¸ªä»å­çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œå³è€—æ—¶æ“ä½œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œå½“æ‰§è¡Œå®Œæ¯•åï¼Œéœ€è¦å°†ç»“æœè¿”ç»™ä¸»çº¿çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ ¹æ®è¿™äº›æ•°æ®ï¼Œæ›´æ–°ç›¸åº”çš„UIã€‚</p>
<h1 id="æ¶ˆæ¯æœºåˆ¶çš„å‡ ä¸ªå¯¹è±¡"><a href="#æ¶ˆæ¯æœºåˆ¶çš„å‡ ä¸ªå¯¹è±¡" class="headerlink" title="æ¶ˆæ¯æœºåˆ¶çš„å‡ ä¸ªå¯¹è±¡"></a>æ¶ˆæ¯æœºåˆ¶çš„å‡ ä¸ªå¯¹è±¡</h1><h2 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h2><p>MessageåŒ…è£¹æ•°æ®çš„æºå¸¦å¯¹è±¡</p>
<h2 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h2><p>Handlerä¸»è¦è´Ÿè´£æŠŠæ¶ˆæ¯æˆ–è€…ä»»åŠ¡putåˆ°MessageQueueä¸­ï¼Œå¯¹æ¶ˆæ¯çš„åˆ†å‘</p>
<h2 id="MessageQuene"><a href="#MessageQuene" class="headerlink" title="MessageQuene"></a>MessageQuene</h2><p>MessageQueneæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸€ä¸ªå•é“¾è¡¨</p>
<h2 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h2><p>Looperæ¶ˆæ¯çš„å‘åŠ¨æœºï¼Œä¸æ–­åœ°ä»MessageQueueä¸­æ‹¿åˆ°æ¶ˆæ¯ï¼Œæœ€åå°†æ¶ˆæ¯ç»™Handleråˆ†å‘ã€‚</p>
<h1 id="Handlerçš„æœºåˆ¶"><a href="#Handlerçš„æœºåˆ¶" class="headerlink" title="Handlerçš„æœºåˆ¶"></a>Handlerçš„æœºåˆ¶</h1><h2 id="Handlerçš„åˆ›å»º"><a href="#Handlerçš„åˆ›å»º" class="headerlink" title="Handlerçš„åˆ›å»º"></a>Handlerçš„åˆ›å»º</h2><p>å¯¹äºHandlerçš„åˆ›å»ºï¼Œæˆ‘ä»¬å¸¸å¸¸å°±æ˜¯ç›´æ¥new Handler()ï¼Œä½†æ˜¯åœ¨Handler()çš„æ„é€ å™¨è¿˜ä¸ºæˆ‘ä»¬åˆå§‹åŒ–äº†æ‰€ä¸çŸ¥é“çš„ä¸€äº›å¯¹è±¡ï¼Œnew Handler()ä¼šè°ƒç”¨Handler(Looper looper, boole aync)åœ¨è¿™ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œä¼šè·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œè€Œä¸»çº¿çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ä¼šåˆ›å»ºä¸»çº¿çº¿ç¨‹çš„Looperï¼Œå°†å…¶ä¿å­˜åœ¨ThreadLocalå¯¹è±¡ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸»çº¿ç¨‹ç›´æ¥new Handler()åˆ™å¾—åˆ°çš„Looperå°±æ˜¯ä¸»çº¿çº¿ç¨‹çš„Looperï¼Œè€Œå½“æˆ‘ä»¬ç›´æ¥åœ¨å­çº¿ç¨‹ä¸­new Handler()ï¼Œåœ¨å­çº¿ç¨‹ä¸­è·å–çš„Looperä¸ºnullï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ </p>
<blockquote>
<p>Canâ€™t create handler inside thread that has not called Looper.prepare()</p>
</blockquote>
<p>å¦‚æœéè¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandler()ï¼Œä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªLooperï¼Œè¿™ä¸ªLooperé€šå¸¸ä¼ ä¸»çº¿ç¨‹çš„Looperï¼Œè¿™å°±èƒ½å›ç­”æœç‹é¢è¯•çš„é—®é¢˜äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ä»ä¸»çº¿è¿›ç¨‹çš„Looperä¸­è·å¾—MessageQueneã€‚è¿™ä¸ªMessageQueneæ˜¯ä»ä¸»çº¿è¿›ç¨‹åˆ›å»ºLooperçš„æ—¶å€™åˆ›å»ºçš„</p>
<h2 id="post-Running-run-ï¼ŒsendMessage-Message-msg"><a href="#post-Running-run-ï¼ŒsendMessage-Message-msg" class="headerlink" title="post(Running run)ï¼ŒsendMessage(Message msg)"></a>post(Running run)ï¼ŒsendMessage(Message msg)</h2><p>ä¸¤ä¸ªæ–¹æ³•æŠŠmsgçš„targetä¹Ÿèµ‹å€¼ä¸ŠHandler.thisåï¼Œè¿™é€šè¿‡MessageQueneçš„enqueueMessageæ–¹æ³•æŠŠMessageå‹å…¥åˆ°MessageQueneä¸­ã€‚</p>
<h2 id="dispatchMessage-Message-msg"><a href="#dispatchMessage-Message-msg" class="headerlink" title="dispatchMessage(Message msg)"></a>dispatchMessage(Message msg)</h2><p>æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šæœ‰å¸¦æœ‰è‡ªå·±çš„target Handleræ¥åˆ†å‘æ¶ˆæ¯ï¼Œæœ€åè°ƒç”¨handleMessage(Message msg)ï¼Œåœ¨é»˜è®¤çš„Handlerä¸­handleMessageæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¦è‡ªå·±æ¥å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œéœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•ä¹Ÿè§£é‡Šçš„é€šäº†ã€‚</p>
<h1 id="Looperçš„æœºåˆ¶"><a href="#Looperçš„æœºåˆ¶" class="headerlink" title="Looperçš„æœºåˆ¶"></a>Looperçš„æœºåˆ¶</h1><p>Looperçš„åˆ›å»ºï¼Œä¸»çº¿çš„Looperåˆ›å»ºåœ¨ActivityThread#mainæ–¹æ³•ä¸­åˆ›å»ºçš„ï¼Œåœ¨Looperçš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†MessageQueneã€‚ActivityThread#mainåœ¨æŠŠä¸€äº›å‡†å¤‡å·¥ä½œåšå®Œåï¼Œå¼€å§‹æ¶ˆæ¯å¾ªç¯Looper.loop()ï¼›</p>
<p>åˆ›å»ºçš„MessgeQueneä¸­ä¸æ–­è·å¾—æ¶ˆæ¯ã€‚è€ŒMessageä¸­æœ‰è‡ªå·±çš„ç›®æ ‡Handlerï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ¶ˆæ¯ç»™è°æ¥å¤„ç†ã€‚æœ€åè°ƒç”¨dispatchMessage(Message msg)ï¼Œå°†æ¶ˆæ¯åˆ†å‘æ‰ã€‚</p>
<p>å½“Handlerå‘é€çš„æ¶ˆæ¯ä¸ºç©ºæ—¶ï¼Œå°†é€€å‡ºæ•´ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œæœ‰æ—¶å€™å‘é€nullçš„æ¶ˆæ¯ä¼šå¯¼è‡´ï¼Œè¿™ä¸ªçº¿ç¨‹çš„Looperæ¶ˆæ¯å¾ªç¯é€€å‡ºï¼Œä¸å»ºè®®å‘é€ç©ºæ¶ˆæ¯ï¼Œåªæœ‰åœ¨é€€å‡ºåº”ç”¨çš„æ—¶å€™å¯ä»¥å‘é€ç©ºæ¶ˆæ¯ã€‚</p>
<h1 id="ä¾èµ–å›¾"><a href="#ä¾èµ–å›¾" class="headerlink" title="ä¾èµ–å›¾"></a>ä¾èµ–å›¾</h1><p><img src="http://www.cfm880.com/2017/11/10/img/QQ20171110-170529%402x.png" alt="ä¾èµ–å›¾"></p>
<h1 id="Viewä¸­çš„postå’ŒHandlerä¸­çš„postæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ"><a href="#Viewä¸­çš„postå’ŒHandlerä¸­çš„postæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ" class="headerlink" title="Viewä¸­çš„postå’ŒHandlerä¸­çš„postæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ"></a>Viewä¸­çš„postå’ŒHandlerä¸­çš„postæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ</h1><p>ä¸€ä¸ªå­—ğŸ˜³ï¼Œè¿™æ˜¯å•¥ï¼Œä¸€é¡¿èŒï¼ŒåŸæ¥åœ¨Viewä¸­çš„postä¹Ÿæ˜¯ä¸€ä¸ªHandlerçš„postï¼Œ<br>è¿™ä¸ªHandleråœ¨ViewRootImplä¸­çš„ViewRootHandlerï¼Œè¿™ä¸ªViewRootHandleræ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼Œæ‰€ä»¥ï¼ŒViewä¸­çš„postå’Œåœ¨Activityä¸­Handlerçš„postï¼Œåªæ˜¯ä¸¤ä¸ªä¸åŒçš„Handlerï¼Œä½†æ˜¯å¯¹åº”çš„æ˜¯åŒä¸€ä¸ªLooperå’ŒMessageQueue</p>
</div><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a class="pre" href="/2017/11/13/äº‹ä»¶åˆ†å‘æœºåˆ¶/">äº‹ä»¶åˆ†å‘æœºåˆ¶</a><a class="next" href="/2017/10/29/æ¯”åˆ†æ›´æ–°åŠŸèƒ½è®°å½•/">æ¯”åˆ†æ›´æ–°åŠŸèƒ½è®°å½•</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Androidç³»ç»Ÿ/">Androidç³»ç»Ÿ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/å‰ç«¯/">å‰ç«¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/å·¥å…·/">å·¥å…·</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/åµŒå…¥å¼/" style="font-size: 15px;">åµŒå…¥å¼</a> <a href="/tags/æœˆè®°/" style="font-size: 15px;">æœˆè®°</a> <a href="/tags/Context/" style="font-size: 15px;">Context</a> <a href="/tags/AndroidåŸç†/" style="font-size: 15px;">AndroidåŸç†</a> <a href="/tags/ç¡¬ä»¶/" style="font-size: 15px;">ç¡¬ä»¶</a> <a href="/tags/Ionic/" style="font-size: 15px;">Ionic</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/VLC/" style="font-size: 15px;">VLC</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/æŠ˜è…¾/" style="font-size: 15px;">æŠ˜è…¾</a> <a href="/tags/flex/" style="font-size: 15px;">flex</a> <a href="/tags/æ„Ÿæ‚Ÿ/" style="font-size: 15px;">æ„Ÿæ‚Ÿ</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/åšå®¢/" style="font-size: 15px;">åšå®¢</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/04/Androidæ ¡æ—¶å…¨è¿‡ç¨‹/">Android æ ¡æ—¶å…¨è¿‡ç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/03/IoT_deploy/">IoTéƒ¨ç½²ç›¸å…³</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/16/å¹´æœ«äº†/">å¹´æœ«äº†</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/13/äº‹ä»¶åˆ†å‘æœºåˆ¶/">äº‹ä»¶åˆ†å‘æœºåˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/10/Androidæ¶ˆæ¯æœºåˆ¶/">Androidæ¶ˆæ¯æœºåˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/æ¯”åˆ†æ›´æ–°åŠŸèƒ½è®°å½•/">æ¯”åˆ†æ›´æ–°åŠŸèƒ½è®°å½•</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/Handlerä½¿ç”¨çš„ä½¿ç”¨/">Handlerä½¿ç”¨ï¼Œå†…å­˜æ³„æ¼çš„å‰å‰åå</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/08/å¸¸ç”¨çš„gitå‘½ä»¤/">å¸¸ç”¨çš„gitå‘½ä»¤</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/Androidè¿›ç¨‹çº¿ç¨‹å’Œå†…å­˜/">Androidè¿›ç¨‹/çº¿ç¨‹å’Œå†…å­˜</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/å¼•å­/">å¼•å­</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/." rel="nofollow">JsonMi.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>